<!DOCTYPE html>
<html>
<head>
    <title>Jot</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../bower_components/fontawesome/css/font-awesome.css">
    <link rel="stylesheet" href="../bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="../bower_components/jquery-ui/themes/base/jquery-ui.css">

    <style>

      body {
        font-family: "FrieghtSans Pro", "Helvetica Neue", sans-serif;
        font-size: 1rem;
      }

      [contenteditable] {
        font-family: "FreightSerif Pro", Georgia, serif;
      }

      input,
      textarea,
      button,
      select {
        font-size: inherit;
        font-family: inherit;
      }

      #editable {
        margin: 2rem auto;
        padding: 1em;
      }

      .btn {
        background: transparent;
        border: 1px solid #2980b9;
        padding: .25em .5em;
        border-radius: 3px;
        color: #2980b9;
        margin: .25rem;
      }

      .btn:hover {
        background: #2980b9;
        color: white;
      }

      .indicator {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        margin: .5rem;
        background: #27ae60;
        color: white;
        transition: background .25s ease-in-out;
      }

      .indicator .fa,
      .indicator .octicon {
        font-size: 1rem;
        line-height: 2rem;
      }

      .indicator.dirty {
        background-color: #c0392b;
      }

      label.checkbox [type='checkbox'] ,
      label.radio [type='radio'] {
        display: none;
      }

      label.checkbox .indicator,
      label.radio .indicator {
        background: #eee;
      }

      label.checkbox :checked ~ .indicator,
      label.radio :checked ~ .indicator {
        background: #27ae60;
      }

    </style>

    <script src="../bower_components/jquery/jquery.js"></script>
    <script src="../bower_components/jquery-ui/ui/jquery-ui.js"></script>
    <script src="../bower_components/rangy/rangy-core.js"></script>
    <script src="../bower_components/showdown/src/showdown.js"></script>
    <script src="../bower_components/to-markdown/src/to-markdown.js"></script>
    <script src="../bower_components/hallo/dist/hallo.js"></script>
    <script src="../bower_components/mousetrap/mousetrap.js"></script>

</head>
<body>

  <div class="about" id="about">
    <h1>Jot</h1>
    <p><em>Git-powered cross-platform word processor.</em></p>
  </div>

  <div class="indicators" id="indicators">
    <span title="File Status" class="indicator file-indicator">
      <i class="fa fa-save"></i>
    </span>
    <span title="Local Status" class="indicator git-local-indicator">
      <i class="octicon octicon-git-commit"></i>
    </span>
    <span title="Remote Status" class="indicator git-remote-indicator">
      <i class="octicon octicon-repo-push"></i>
    </span>
  </div>

  <div class="filesystem-ui" id="filesystem-ui">
    <button class="btn" id="openButton">Open File</button>
    <button class="btn" id="saveButton">Save File</button>
    <button class="btn" id="closeButton">Close File</button>
  </div>

  <label class="checkbox">
    <input type="checkbox" id="commitOnSave">
    <span class="indicator"></span>
    Commit on Save
  </div>

  <label class="checkbox">
    <input type="checkbox" id="pushOnSave">
    <span class="indicator"></span>
    Push on Save
  </div>

  <button class="btn" id="commitButton">Commit</button>
  <button class="btn" id="pushButton">Push</button>

  <input id="openFile" type="file" style="display:none" accept="text/*/">
  <input id="saveFile" type="file" style="display:none" accept="text/*/" nwsaveas>
  <p id="path"></p>

  <div id="editable" contenteditable="true"></div>

  <script>
    // pilfered from http://hallojs.org/demo/markdown/
    jQuery(document).ready(function() {
      // Enable Hallo editor
      window.halloInstance = jQuery('#editable').hallo({
        plugins: {
          'halloformat': {},
          'halloheadings': {},
          'hallolists': {},
          'halloreundo': {}
        },
        toolbar: 'halloToolbarFixed'
      });

      var markdownize = function(content) {
        var html = content.split("\n").map($.trim).filter(function(line) { 
          return line != "";
        }).join("\n");
        return toMarkdown(html);
      };

      var converter = new Showdown.converter();
      var htmlize = function(content) {
        return converter.makeHtml(content);
      };

      // Method that converts the HTML contents to Markdown
      var showSource = function(content) {
        var markdown = markdownize(content);
        if (jQuery('#source').get(0).value == markdown) {
          return;
        }
        jQuery('#source').get(0).value = markdown;
      };


      var updateHtml = function(content) {
        if (markdownize(jQuery('#editable').html()) == content) {
          return;
        }
        var html = htmlize(content);
        jQuery('#editable').html(html); 
      };

    }); 

  </script>

  <script src="../js/keyboard.js"></script>

  <script src="../js/init.js"></script>
</body>
</html>